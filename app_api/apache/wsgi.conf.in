ExpiresActive On
RewriteEngine On

# static ressources
FileETag none

RewriteRule ^{base_url}/?[a-f0-9]+/static/(.*) {base_dir}/app_api/static/$1

<LocationMatch {base_url}/?[a-f0-9]+/static>
  ExpiresDefault "now plus 1 day"
  Header merge Cache-Control "public"
</LocationMatch>

# disable cache when version is '0' (dev mode)
<LocationMatch {base_url}/?0/static>
  Header set Cache-Control "max-age=0, must-revalidate, no-cache, no-store"
</LocationMatch>

# wsgi application
WSGIDaemonProcess api-{instanceid} python-path={site_packages}

WSGIScriptAlias {base_url} {base_dir}/apache/app-api.wsgi

<Location {base_url}>
  WSGIProcessGroup api-{instanceid}
  WSGIApplicationGroup %{{GLOBAL}}
</Location>

# force https
RewriteCond %{{HTTP:X-Forwarded-Proto}} !https
RewriteRule ^/?(.*) https://%{{SERVER_NAME}}/$1 [R=301,L]
